<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>四. 对象实例化原理分析 | 杰哥课堂</title>
    <meta name="description" content="杰哥出品">
    <meta name="generator" content="VuePress 1.3.1">
    
    
    <link rel="preload" href="/assets/css/0.styles.5c808b14.css" as="style"><link rel="preload" href="/assets/js/app.321d41b9.js" as="script"><link rel="preload" href="/assets/js/2.ab4310a8.js" as="script"><link rel="preload" href="/assets/js/10.f2d458fd.js" as="script"><link rel="prefetch" href="/assets/js/11.6ad55b69.js"><link rel="prefetch" href="/assets/js/12.c01fe802.js"><link rel="prefetch" href="/assets/js/13.a75c5cf2.js"><link rel="prefetch" href="/assets/js/14.b7e64910.js"><link rel="prefetch" href="/assets/js/15.6918f47c.js"><link rel="prefetch" href="/assets/js/16.b4083c06.js"><link rel="prefetch" href="/assets/js/3.232fa181.js"><link rel="prefetch" href="/assets/js/4.3b8bad7e.js"><link rel="prefetch" href="/assets/js/5.895b4ff8.js"><link rel="prefetch" href="/assets/js/6.317baa63.js"><link rel="prefetch" href="/assets/js/7.e27eaf99.js"><link rel="prefetch" href="/assets/js/8.2d64a9cd.js"><link rel="prefetch" href="/assets/js/9.03dc8f9a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5c808b14.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/assets/img/logo.png" alt="杰哥课堂" class="logo"> <span class="site-name can-hide">杰哥课堂</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端教程" class="dropdown-title"><span class="title">前端教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/js_oop/" class="nav-link router-link-active">
  JavaScript面向对象
</a></li><li class="dropdown-item"><!----> <a href="/web/vue2/" class="nav-link">
  Vue2.x快速入门
</a></li><li class="dropdown-item"><!----> <a href="/web/todolist/" class="nav-link">
  从零打造前端项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PHP教程" class="dropdown-title"><span class="title">PHP教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/mysql/" class="nav-link">
  MySQL基础
</a></li><li class="dropdown-item"><!----> <a href="/php/laravel54/" class="nav-link">
  Laravel5.4快速入门
</a></li><li class="dropdown-item"><!----> <a href="/php/swoole/" class="nav-link">
  Swoole快速入门
</a></li></ul></div></div><div class="nav-item"><a href="https://space.bilibili.com/263804322" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端教程" class="dropdown-title"><span class="title">前端教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web/js_oop/" class="nav-link router-link-active">
  JavaScript面向对象
</a></li><li class="dropdown-item"><!----> <a href="/web/vue2/" class="nav-link">
  Vue2.x快速入门
</a></li><li class="dropdown-item"><!----> <a href="/web/todolist/" class="nav-link">
  从零打造前端项目
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="PHP教程" class="dropdown-title"><span class="title">PHP教程</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/php/mysql/" class="nav-link">
  MySQL基础
</a></li><li class="dropdown-item"><!----> <a href="/php/laravel54/" class="nav-link">
  Laravel5.4快速入门
</a></li><li class="dropdown-item"><!----> <a href="/php/swoole/" class="nav-link">
  Swoole快速入门
</a></li></ul></div></div><div class="nav-item"><a href="https://space.bilibili.com/263804322" target="_blank" rel="noopener noreferrer" class="nav-link external">
  B站
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>JavaScript面向对象</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/web/js_oop/" class="sidebar-link">课程介绍</a></li><li><a href="/web/js_oop/1-类和对象.html" class="sidebar-link">一. 类和对象</a></li><li><a href="/web/js_oop/2-JS中的类和对象.html" class="sidebar-link">二. 初步认识 JS 中的类和对象</a></li><li><a href="/web/js_oop/3-对象的方法.html" class="sidebar-link">三. 对象的方法</a></li><li><a href="/web/js_oop/4-对象实例化原理.html" class="active sidebar-link">四. 对象实例化原理分析</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web/js_oop/4-对象实例化原理.html#_1-引用数据类型" class="sidebar-link">1 引用数据类型</a></li><li class="sidebar-sub-header"><a href="/web/js_oop/4-对象实例化原理.html#_2-new-实例化的过程" class="sidebar-link">2 new 实例化的过程</a></li><li class="sidebar-sub-header"><a href="/web/js_oop/4-对象实例化原理.html#_3-为什么不在构造函数中定义方法" class="sidebar-link">3 为什么不在构造函数中定义方法</a></li><li class="sidebar-sub-header"><a href="/web/js_oop/4-对象实例化原理.html#_4-初步解决" class="sidebar-link">4 初步解决</a></li><li class="sidebar-sub-header"><a href="/web/js_oop/4-对象实例化原理.html#_5-初步了解-this-指向" class="sidebar-link">5 初步了解 this 指向</a></li></ul></li><li><a href="/web/js_oop/5-原型初步.html" class="sidebar-link">五. 原型初步</a></li><li><a href="/web/js_oop/6-原型深入.html" class="sidebar-link">六. 原型深入</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1><a href="#四-对象实例化原理分析" class="header-anchor">#</a> 四. 对象实例化原理分析</h1> <h2><a href="#_1-引用数据类型" class="header-anchor">#</a> 1 引用数据类型</h2> <p>对象是一种特殊的数据, 看如下代码</p> <blockquote><p>示例</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义一个学生类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
<span class="token punctuation">}</span>
<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>这里并<strong>不是</strong>把所有的数据直接保存在变量中</li> <li>而是先在堆区开辟一个空间, 把这个空间的<strong>引用</strong>保存在变量中.</li> <li>在 js 中, ==函数==和==对象==都是<strong>引用</strong>数据类型</li></ul> <p><img src="images/1565939764990.png" alt="1565939764990"></p> <p>这里有个词--&quot;==引用==&quot;</p> <blockquote><p>什么是引用呢, 引用有什么用呢?</p></blockquote> <p>一句话解释: ==<strong>引用</strong>就是来找数据的==</p> <p>类似于路径的概念, 就像我们可以通过路径<code>E:\docment\image\img.jpg</code>找到电脑中的一个文件,</p> <p>又或者酒店的房间号, 通过房间号就可以找到房间</p> <p>通过引用就可以找到内存中的数据.</p> <p>引用本质上是<strong>内存首地址</strong>. 通过这个地址就可以找到对应的内存空间, 进而获取数据</p> <h2><a href="#_2-new-实例化的过程" class="header-anchor">#</a> 2 new 实例化的过程</h2> <blockquote><p>示例</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义一个学生类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
<span class="token punctuation">}</span>
<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p><img src="images/new%E8%BF%87%E7%A8%8B.gif" alt="new过程"></p> <p>当代码执行到行 7 行时.</p> <ol><li><p>在堆内存中开辟一段内存空间, 假设这段内存空间是从<code>0x1111~0x2000</code>[^3]</p> <p>因此通过<code>0x1111</code>就可以找到对应的这段内存空间, 进而获取其中的数据</p></li> <li><p>将<code>0x1111</code>保存在<code>this</code>中, 我们也可以说让 this 指向这个空间</p></li> <li><p>执行函数. 通过<code>this=0x1111</code>找到内存空间, 在这个空间中保存数据<code>name:xiaoming,age:20</code></p></li> <li><p>最后, 将<code>0x1111</code>返回, 保存在 stu 中</p></li></ol> <blockquote><p>练习</p></blockquote> <p>如果再实例化一个对象 stu1, (假设内存地址是 0x2222), 画出实例化的过程</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义一个学生类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
<span class="token punctuation">}</span>
<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><blockquote><p>参考答案</p></blockquote> <p><img src="images/1565942200223.png" alt="1565942200223"></p> <p>这样, 我们就可以通过一个模板(Student 构造函数)得到多个不同的对象(stu 对象和 stu1 对象). 对象中保存的数据也不一样.</p> <h2><a href="#_3-为什么不在构造函数中定义方法" class="header-anchor">#</a> 3 为什么不在构造函数中定义方法</h2> <p>我们在上面的基础上进一步深入.</p> <blockquote><p>示例</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">sayHi</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>上述代码的图解如下:</p> <p><img src="images/1565944523218.png" alt="1565944523218"></p> <p>这就解释了我们前面的问题. 虽然 sayHi 方法的代码是相同的, 但是每次实例化时会开辟一个新的内存空间, 造成浪费.</p> <h2><a href="#_4-初步解决" class="header-anchor">#</a> 4 初步解决</h2> <p>既然方法是相同的, 我们可不可以单独定义一个函数赋值给 sayHi 呢?</p> <blockquote><p>示例: 4-1 初步解决方法定义.html</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 初步解决方案</span>

<span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>上述代码图解如下:</p> <p><img src="images/1565945656148.png" alt="1565945656148"></p> <p>这样做确实可以解决, 但是这种做法很奇怪. 一般也不会使用, 为什么这么说呢.</p> <p>照理说, <code>sayHi</code>函数应该仅仅是属于 Student 类. 只有通过 Student 类实例化出来的对象可以调用. 而如果把<code>sayHi</code>放在全局下. 可以当成普通函数调用. 因此, 我们称这种做法破坏了类的<code>封装性</code>.</p> <blockquote><p>什么是<strong>封装性</strong>?</p> <p>==类的成员尽量封闭在类的内部, 隐藏细节与实现==</p></blockquote> <p>看下面这个示例</p> <blockquote><p>示例: 4-2 初步解决方案带来的问题.html</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// 使用对象调用可以得到希望的结果</span>
stu<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫xiaoming</span>

<span class="token comment">// 当普通函数直接调用, 会得到'奇怪'的结果</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>为什么会出现这种'奇怪'的现象. 要搞明白这个问题, 就要了解 js 中的 this 指向[^2]</p> <h2><a href="#_5-初步了解-this-指向" class="header-anchor">#</a> 5 初步了解 this 指向</h2> <p>为了搞清楚构造函数中的 this, 我们还是先通过图解的方式来分析</p> <blockquote><p>示例</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// 使用对象调用可以得到希望的结果</span>
stu<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫xiaoming</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>图解</p></blockquote> <p><img src="images/%E5%AF%B9%E8%B1%A1%E8%B0%83%E7%94%A8%E6%96%B9%E6%B3%95%E7%9A%84%E8%BF%87%E7%A8%8B.gif" alt="对象调用方法的过程"></p> <p>通过上面的分析. 我们至少可以得出这样的结论</p> <ol><li>this 也是一种引用数据类型</li> <li>this 的指向是在函数调用时确定的</li></ol> <p>上述代码, 更为准确的写法是</p> <blockquote><p>示例:</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// call表示调用函数, 并确定this指向stu对象</span>
stu<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>stu<span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫xiaoming</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>思考: 4-3 思考题答案.html</p> <p>如果在调用 sayHi 的时候, 让 this 指向 stu1, 大家思考一下会得到什么结果</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// call表示调用函数, 并规定this指向stu1对象</span>
stu<span class="token punctuation">.</span><span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>stu1<span class="token punctuation">)</span> <span class="token comment">// ???</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><blockquote><p>思考题答案</p> <p>大家好, 我叫 xiaomei</p></blockquote> <p>过程分析</p> <ol><li>通过 stu 找到 0x1111</li> <li>调用 sayHi 函数</li> <li>确定 this 指向 stu1</li> <li>通过 this 找到 this.uname, 也就是 stu1.uname 等于 xiaomei</li></ol> <p>最后, 我们分析把<code>sayHi</code>当普通函数调用的过程</p> <p>如果把<code>sayHi</code>当普通函数调用, 相当于在全局对象(在浏览器环境中是 window)添加了属性和方法</p> <p>因此, 更准确的写法如下</p> <blockquote><p>示例: 4-4 当做普通函数调用.html</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// call表示调用函数, 并确定this指向window对象</span>
<span class="token comment">// 在window对象中并没有uname这个属性, 因此值为undefined</span>
<span class="token function">sayHi</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫undefined</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><blockquote><p>思考</p> <p>如果我们人为在 window 中添加一个 uname 属性会怎样呢?</p></blockquote> <blockquote><p>示例</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 一. 定义类</span>
<span class="token keyword">function</span> <span class="token function">Student</span><span class="token punctuation">(</span><span class="token parameter">n<span class="token punctuation">,</span> a</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>uname <span class="token operator">=</span> n
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> a
  <span class="token keyword">this</span><span class="token punctuation">.</span>sayHi <span class="token operator">=</span> sayHi
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'大家好, 我叫'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>uname<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 二. 实例化对象</span>
<span class="token keyword">var</span> stu <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaoming'</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span>
<span class="token keyword">var</span> stu1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Student</span><span class="token punctuation">(</span><span class="token string">'xiaomei'</span><span class="token punctuation">,</span> <span class="token number">18</span><span class="token punctuation">)</span>

<span class="token comment">// 定义一个全局变量, 相当于在window对象中添加了一个uname属性</span>
<span class="token keyword">var</span> uname <span class="token operator">=</span> <span class="token string">'全局uname'</span>
<span class="token function">sayHi</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 大家好, 我叫全局uname</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h1><a href="#" class="header-anchor">#</a></h1></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web/js_oop/3-对象的方法.html" class="prev">
        三. 对象的方法
      </a></span> <span class="next"><a href="/web/js_oop/5-原型初步.html">
        五. 原型初步
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.321d41b9.js" defer></script><script src="/assets/js/2.ab4310a8.js" defer></script><script src="/assets/js/10.f2d458fd.js" defer></script>
  </body>
</html>
